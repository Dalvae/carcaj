function f(){return{tooltipVisible:!1,tooltipContent:"",tooltipStyle:{top:"0px",left:"0px"},hideTimer:null,isMobile(){return window.innerWidth<=1e3},getFootnoteText(n){var o,e;const i=n.parentNode.cloneNode(!0);return(o=i.querySelector('a[id^="sdfootnote"], a[id^="_ftn"]'))==null||o.remove(),i.querySelectorAll('a[href^="#sdfootnote"], a[href^="#_ftnref"]').forEach(t=>t.remove()),(e=i.querySelector("sup"))==null||e.remove(),i.innerHTML.trim().replace(/^\s*\[\d+\]\s*/,"").replace(/^\s*\d+\s*/,"")},initialize(){const n=this.$el.querySelector(".wp-block-separator"),i=e=>(n==null?void 0:n.compareDocumentPosition(e))&Node.DOCUMENT_POSITION_FOLLOWING;this.$el.querySelectorAll('a[href*="_ftn"], a[href*="sdfootnote"]').forEach((e,t)=>{const s=e.getAttribute("href"),d=s.substring(1).replace(/^sdfootnoteanc/,"sdfootnotesym"),r=document.getElementById(d);if(!r)return;if(i(e)){e.addEventListener("click",l=>{l.preventDefault();const c=document.getElementById(s.replace("_ftn","_ftnref").substring(1));c==null||c.scrollIntoView({behavior:"smooth"})});return}const a=this.getFootnoteText(r);this.isMobile()?(e.dataset.footnoteId=t,e.addEventListener("click",l=>{l.preventDefault(),l.stopPropagation(),console.log("Mobile footnote link clicked."),this.toggleMobileFootnote(e,a)})):(e.addEventListener("mouseover",l=>{this.showTooltip(l.currentTarget,a)}),e.addEventListener("mouseout",()=>{this.hideTooltip()}),e.addEventListener("click",l=>{l.preventDefault(),r.scrollIntoView({behavior:"smooth"})}))})},showTooltip(n,i){clearTimeout(this.hideTimer),this.tooltipContent=i,this.tooltipVisible=!0,this.$nextTick(()=>{const o=this.$refs.tooltip;if(!o)return;const e=n.getBoundingClientRect(),t=window.innerWidth,s=window.innerHeight;o.style.left="0px";let d=Math.max(10,Math.min(e.left,t-o.offsetWidth-20)),r=e.bottom+5;e.bottom+o.offsetHeight>s&&e.top>o.offsetHeight&&(r=e.top-o.offsetHeight-5),this.tooltipStyle={left:`${d}px`,top:`${r}px`}})},hideTooltip(){this.hideTimer=setTimeout(()=>{this.tooltipVisible=!1},200)},toggleMobileFootnote(n,i){console.log("Toggling mobile footnote for:",n);const o=n.dataset.footnoteId,e=document.getElementById(`expanded-footnote-${o}`);if(console.log("Existing note:",e),document.querySelectorAll(".expanded-footnote").forEach(s=>{s.id!==`expanded-footnote-${o}`&&(s.classList.add("removing"),s.classList.remove("entering"),setTimeout(()=>s.remove(),200))}),e){console.log("Removing existing note."),e.classList.add("removing"),e.classList.remove("entering"),setTimeout(()=>e.remove(),200);return}console.log("Creating new expanded note.");const t=document.createElement("div");t.id=`expanded-footnote-${o}`,t.className="expanded-footnote",t.innerHTML=i,this.insertExpandedNote(n,t),requestAnimationFrame(()=>{console.log("Note inserted. Animating open."),t.classList.add("entering"),t.style.maxHeight=t.scrollHeight+"px"}),t.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),t.classList.add("removing"),t.classList.remove("entering"),setTimeout(()=>t.remove(),200)})},insertExpandedNote(n,i){const o=n.closest("sup")||n.querySelector("sup"),e=(o||n).nextSibling;if((e==null?void 0:e.nodeType)===Node.TEXT_NODE&&(e.textContent.startsWith(".")||e.textContent.startsWith(",")||e.textContent.startsWith(" "))){const[t,...s]=e.textContent,d=document.createTextNode(t),r=document.createTextNode(s.join(""));e.parentNode.replaceChild(d,e),d.parentNode.insertBefore(i,d.nextSibling),i.parentNode.insertBefore(r,i.nextSibling)}else(o||n).insertAdjacentElement("afterend",i)}}}document.addEventListener("alpine:init",()=>{Alpine.data("footnotes",f)});
